<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <title></title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='js/mapbox-gl-dev.js'></script>
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.2.2/mapbox-gl.css' rel='stylesheet' />
    <style>
        body { margin:0; padding:0; }
        #map { position:absolute; top:0; bottom:0; width:100%; }
        button {
          display: block;
          position: absolute;
          top:20px;
          left:5px;
          width: 50px;
          height: 40px;
          padding: 10px;
          border: none;
          border-radius: 3px;
          font-size: 12px;
          text-align: center;
          color: #fff;
          background: #16a085;
        }

        #step1 {
          top:5px;
        }
        #step2 {
          top:50px;
          background: #2980b9;
        }
        #step3 {
          top:95px;
          background: #2c3e50;
        }
        #step4 {
          top:140px;
          background: #9b59b6;
        }
        #step5 {
          top:185px;
          background: #bdc3c7;
        }
        #info{
          position:absolute;
          bottom:20px;
          left:5px;
          width:200px;
          height:300px;
          font-size:14px;
          background:#fff;
          padding:10px;
          overflow:hidden;
          overflow-y:auto;
        }

        
        
        
    </style>
</head>
<body onload="load();">

<div id='map'></div>
<button onclick='step1();' id='step1'>1</button>
<button onclick='step2();' id='step2'>2</button>
<button onclick='step3();' id='step3'>3</button>
<button onclick='step4();' id='step4'>4</button>
<button onclick='step5();' id='step5'>5</button>
<div id="info">
  <div id="zoom"></div>
  <div id="layers"></div>
</div>
<script>
var info = {};
var map;

function updateInfo(){
  var layers = d3.select('#layers');
  layers.html(Object.keys(info).join('<br/>'));
}

function load(){
  map = new mapboxgl.Map({
    container: 'map', // container id
    style: 'esri-styles_v1.6.json', //stylesheet location
    center: [37.7833, -122.4167], // starting position
    zoom: 14 // starting zoom
  });
  map.addControl(new mapboxgl.Navigation());

  map.on('zoom',function(){
    d3.select('#zoom').html('zoom: ' + map.getZoom());
  });

  map.on('click', function(e){
    map.featuresAt(e.point, {}, function(err, features){
      console.log(features);
    }); 
  });
}

function clear(){
  map.style.removeClass('step1');
  map.style.removeClass('step2');
  map.style.removeClass('step3');
  map.style.removeClass('parkflash2');
  if (timer) clearInterval(timer);
}

var zoomed = false, timer;
function step1() { 
  clear();
  map.style.addClass('dark');
  map.flyTo([37.7833, -122.4167], 13, 0, function(){
  });
}
function step2() { 
  clear();
  map.flyTo([37.7833, -122.4167], 14, 10);
  map.style.removeClass('dark');
}
function step3() { 
  clear();
  map.flyTo([37.7833, -122.4167], 16, -20);
  map.style.removeClass('dark');
}
function step4() { 
  clear();
  map.flyTo([37.7833, -122.4167], 15, 30);
  //map.style.addClass('dark');
  timer = setInterval(function(){
    console.log('go');
    map.style.addClass('parkflash2');
    setTimeout(function(){
      map.style.removeClass('parkflash2');  
    },700);
  },1500);
}
function step5() { 
  clear();
  map.flyTo([37.7833, -122.4167], 14, -70);
  map.style.removeClass('dark');
}
</script>
</script>

</body>
</html>
